<!DOCTYPE html>
<html>

<head>
    <title>AR.js A-Frame Location-based</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script type='text/javascript'
        src='https://raw.githack.com/AR-js-org/AR.js/3.4.5/three.js/build/ar-threex-location-only.js'></script>
    <script type='text/javascript'
        src='https://raw.githack.com/AR-js-org/AR.js/3.4.5/aframe/build/aframe-ar.js'></script>
</head>

<body>
    <a-scene vr-mode-ui='enabled: false' arjs='sourceType: webcam; videoTexture: true; debugUIEnabled: false'
        renderer='antialias: true; alpha: true'>
        <a-camera cursor="rayOrigin: mouse" raycaster="far: 10; objects: .clickable">
            <a-entity id="loadingStatus" position="0 0 -1"
                text="value: Carregando...; color: white; align: center; width: 2">
            </a-entity>
        </a-camera>
        </a-box>
        <a-assets>
            <video id="meuVideo" autoplay loop="true" src="vv2.webm"></video>
        </a-assets>
    </a-scene>
    <script>

        // Para serem clicáveis os objetos precisam estar a uma distãncia menor que 0,001
        // Isso ocorre devido a minha configuração de raycaster 
        const positionConfigs = [
            { lat: -0.0005, long: -0.0007, id: 'Box1N', color: 'yellow', descricao: 'Atrás à esquerda' },
            { lat: -0.0007, long: 0, id: 'Box2N', color: 'blue', descricao: 'Atrás' },
            { lat: -0.0005, long: 0.0007, id: 'Box3N', color: 'black', descricao: 'Atrás à direita' },
            { lat: 0.0007, long: 0, id: 'Box4N', color: 'red', descricao: 'Frente' },
            { lat: 0, long: 0.0007, id: 'Box5N', color: 'green', descricao: 'Lado direito' },
            { lat: 0, long: -0.0007, id: 'Box6N', color: 'pink', descricao: 'Lado esquerdo' }
        ];

        window.onload = () => {
            let testEntityAdded = false;

            if (!testEntityAdded) {

                const cubos = [
                    { x: 5, y: 1, z: -5, cor: 'gray' },   // frente direita
                    { x: 0, y: 1, z: -5, cor: 'red' },    // frente
                    { x: -5, y: 1, z: -5, cor: 'yellow' },// frente esquerda
                    { x: 5, y: 1, z: 5, cor: 'black' },   // atrás direita
                    { x: 0, y: 1, z: 5, cor: 'blue' },    // atrás
                    { x: -5, y: 1, z: 5, cor: 'pink' },    // atrás esquerda
                    { x: 0, y: 5, z: -5, cor: 'red' },    // frente cima
                    { x: 0, y: 5, z: 5, cor: 'red' },    // frente cima
                ];

                cubos.forEach(cubo => {
                    AddPlane(cubo.x, cubo.y, cubo.z, cubo.cor);
                });

                // Remove carregando...
                document.getElementById('loadingStatus').setAttribute('visible', 'false');
            }
            testEntityAdded = true;
        };


        function AddCube(latitude = 0, altura = 0, longitude = 0, color) {
            const box = document.createElement('a-box');
            position = `${latitude} ${altura} ${longitude} `
            box.setAttribute('position', position);
            box.setAttribute('color', color);
            box.setAttribute('depth', '1');
            box.setAttribute('height', '1');
            box.setAttribute('width', '1');
            box.setAttribute('class', 'clickable');
            box.addEventListener('click', () => {
                alert(`Cubo ${box.id || 'sem ID'} clicado!`);
            });
            document.querySelector('a-scene').appendChild(box);
        }

        function AddPlane(latitude = 0, altura = 0, longitude = 0, color) {
            const box = document.createElement('a-plane');
            box.setAttribute('width', 4);
            box.setAttribute('height', 3);
            // faz com que o plano rotacione para sempre ficar virado para a câmera,
            // necessário dependência <!-- <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>-->
            box.setAttribute('look-at', '[camera]');
            position = `${latitude} ${altura} ${longitude} `
            box.setAttribute('position', position);
            box.setAttribute('material', 'src: #meuVideo');
            box.setAttribute('transparent', 'true');
            box.setAttribute('class', 'clickable');
            box.addEventListener('click', () => {
                alert(`Cubo ${box.id || 'sem ID'} clicado!`);
            });
            document.querySelector('a-scene').appendChild(box);
        }
    </script>
</body>

</html>