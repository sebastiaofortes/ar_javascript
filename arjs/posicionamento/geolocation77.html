<!DOCTYPE html>
<html>

<head>
    <title>AR.js A-Frame Location-based</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script type='text/javascript'
        src='https://raw.githack.com/AR-js-org/AR.js/3.4.5/three.js/build/ar-threex-location-only.js'></script>
    <script type='text/javascript'
        src='https://raw.githack.com/AR-js-org/AR.js/3.4.5/aframe/build/aframe-ar.js'></script>
</head>

<body>
    <a-scene vr-mode-ui='enabled: false' arjs='sourceType: webcam; videoTexture: true; debugUIEnabled: false'
        renderer='antialias: true; alpha: true'>
        <a-camera cursor="rayOrigin: mouse" raycaster="far: 10; objects: .clickable">
            <a-entity id="loadingStatus" position="0 0 -1"
                text="value: Carregando...; color: white; align: center; width: 2">
            </a-entity>

              <!-- HUD do contador -->
            <a-text id="scoreText"
                value="Pontos: 0"
                color="yellow"
                width="2"
                align="left"
                position="-1.2 0.7 -1">
            </a-text>
        </a-camera>
        </a-box>
        <a-assets>
            <video id="meuVideo" autoplay loop="true" src="vv2.webm"></video>
        </a-assets>
    </a-scene>
    <script>

        // Para serem clicáveis os objetos precisam estar a uma distãncia menor que 0,001
        // Isso ocorre devido a minha configuração de raycaster 
        const positionConfigs = [
            { x: 5, y: 1, z: -5, cor: 'gray' },   // frente direita
            { x: 0, y: 1, z: -5, cor: 'red' },    // frente
            { x: -5, y: 1, z: -5, cor: 'yellow' },// frente esquerda
            { x: 5, y: 1, z: 5, cor: 'black' },   // atrás direita
            { x: 0, y: 1, z: 5, cor: 'blue' },    // atrás
            { x: -5, y: 1, z: 5, cor: 'pink' },    // atrás esquerda
            { x: 0, y: 5, z: -5, cor: 'red' },    // frente cima
            { x: 0, y: 5, z: 5, cor: 'red' },    // frente cima
        ];

        window.onload = () => {
            let testEntityAdded = false;

            if (!testEntityAdded) {

                AddPlane(0, 1, -5, 'red');
                // Remove carregando...
                document.getElementById('loadingStatus').setAttribute('visible', 'false');
            }
            testEntityAdded = true;
        };


        function AddCube(latitude = 0, altura = 0, longitude = 0, color) {
            const box = document.createElement('a-box');
            position = `${latitude} ${altura} ${longitude} `
            box.setAttribute('position', position);
            box.setAttribute('color', color);
            box.setAttribute('depth', '1');
            box.setAttribute('height', '1');
            box.setAttribute('width', '1');
            box.setAttribute('class', 'clickable');
            box.addEventListener('click', () => {
                alert(`Cubo ${box.id || 'sem ID'} clicado!`);
            });
            document.querySelector('a-scene').appendChild(box);
        }

        function AddPlane(latitude = 0, altura = 0, longitude = 0, color) {
            const box = document.createElement('a-plane');
            box.setAttribute('width', 4);
            box.setAttribute('height', 3);
            // faz com que o plano rotacione para sempre ficar virado para a câmera,
            // necessário dependência <!-- <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script> -->
            box.setAttribute('look-at', '[camera]');
            position = `${latitude} ${altura} ${longitude} `
            box.setAttribute('position', position);
            box.setAttribute('material', 'src: #meuVideo');
            box.setAttribute('transparent', 'true');
            box.setAttribute('class', 'clickable');
            box.addEventListener('click', () => {
                const newPosition = getRandomPositionConfig();
                position = `${newPosition.x} ${newPosition.y} ${newPosition.z} `
                
                let scale = box.getAttribute("scale");
                let interval = setInterval(() => {
                    if (scale.x <= 0.01) {
                        clearInterval(interval); // Restaura o tamanho original após o encolhimento total
                        box.setAttribute("scale", "1 1 1");
                        // moda a posição
                        box.setAttribute('position', position);
                    } else {
                        scale.x *= 0.9; scale.y *= 0.9; scale.z *= 0.9;
                        box.setAttribute("scale", `${scale.x} ${scale.y} ${scale.z}`);
                    }
                }, 25);
            });
            document.querySelector('a-scene').appendChild(box);
        } function getRandomPositionConfig() {
            const
            index = Math.floor(Math.random() * positionConfigs.length); return positionConfigs[index];
        } </script>
</body>

</html>