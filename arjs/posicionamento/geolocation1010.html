<!DOCTYPE html>
<html>

<head>
    <title>AR.js A-Frame Location-based</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    <script type='text/javascript'
        src='https://raw.githack.com/AR-js-org/AR.js/3.4.5/three.js/build/ar-threex-location-only.js'></script>
    <script type='text/javascript'
        src='https://raw.githack.com/AR-js-org/AR.js/3.4.5/aframe/build/aframe-ar.js'></script>
</head>

<body>
    <div id="startScreen" style="position: absolute; top: 0; left: 0; 
    width: 100%; height: 100%; background: rgba(0,0,0,0.8); 
    display: flex; flex-direction: column; justify-content: center; 
    align-items: center; color: white; font-size: 5vw; z-index: 10; text-align: center;">
    
        <p>Instruções: Clique nos drones para os destruir e ganhar pontos!</p>
        <button id="playButton" style="padding: 2vw 4vw; font-size: 5vw;">Jogar</button>
    </div>
    <a-scene vr-mode-ui='enabled: false' arjs='sourceType: webcam; videoTexture: true; debugUIEnabled: false'
        renderer='antialias: true; alpha: true'>
        <a-entity light="type: ambient; color: #ffffff; intensity: 4"></a-entity>
        <a-camera cursor="rayOrigin: mouse" raycaster="far: 1000; objects: .clickable">
            <a-entity id="loadingStatus" position="0 0 -1"
                text="value: Carregando...; color: white; align: center; width: 2">
            </a-entity>

              <!-- HUD do contador -->
            <a-text id="scoreText"
                value="Pontos: 0"
                color="yellow"
                width="2"
                align="left"
                position="-0.2 0.7 -1">
            </a-text>
        </a-camera>
        <a-assets>
            <a-asset-item id="avatarModel" src="mech_drone.glb"></a-asset-item>
        </a-assets>
        <a-gltf-model src="#avatarModel" animation-mixer scale="3 3 3" position="0 1 -2" id="gophermodel" visible="true" class="clickable">
        </a-gltf-model>
    </a-scene>
    <script>
        let score = 0;

        gophermodel.addEventListener("click", event => {
            score += 1;
            document.getElementById('scoreText').setAttribute('value', `Pontos: ${score}`);

            const newPosition = getRandomPositionConfig();
            position = `${newPosition.x} ${newPosition.y} ${newPosition.z}`;

            let scale = gophermodel.getAttribute("scale");
            let interval = setInterval(() => {
                if (scale.x <= 0.01) {
                    clearInterval(interval);
                    gophermodel.setAttribute("scale", "3 3 3");
                    gophermodel.setAttribute('position', position);
                } else {
                    scale.x *= 0.9; scale.y *= 0.9; scale.z *= 0.9;
                    gophermodel.setAttribute("scale", `${scale.x} ${scale.y} ${scale.z}`);
                }
            }, 25);
        });

        // Para serem clicáveis os objetos precisam estar a uma distãncia menor que 0,001
        // Isso ocorre devido a minha configuração de raycaster 
        const positionConfigs = [
            { x: 2, y: 1, z: -2, cor: 'gray' },   // frente direita
            { x: 0, y: 1, z: -2, cor: 'red' },    // frente
            { x: -2, y: 1, z: -2, cor: 'yellow' },// frente esquerda
            { x: 2, y: 1, z: 2, cor: 'black' },   // atrás direita
            { x: 0, y: 1, z: 2, cor: 'blue' },    // atrás
            { x: -2, y: 1, z: 2, cor: 'pink' },    // atrás esquerda
            { x: 0, y: 2, z: -2, cor: 'red' },    // frente cima
            { x: 0, y: 2, z: 2, cor: 'red' },    // frente cima
        ];

        window.onload = () => {
            let testEntityAdded = false;

            if (!testEntityAdded) {
                document.getElementById('loadingStatus').setAttribute('visible', 'false');
            }
            testEntityAdded = true;

                // Botão de Play
            document.getElementById('playButton').addEventListener('click', () => {
                document.getElementById('startScreen').style.display = 'none'; // Esconde a tela inicial
            });
        };
        
        function getRandomPositionConfig() {
            const index = Math.floor(Math.random() * positionConfigs.length); return positionConfigs[index];
        } 

        </script>
</body>

</html>